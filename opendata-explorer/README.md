Обновлено: 29.11.2017
___________________

В целом, сервис OpenData API от НБУ удовлетворяет большинству требований 
для работы **Open Data Explorer** :metal:

1. Для создания формы запроса используются следующие ресурсы:

    1.1. [Statdirectory](https://bank.gov.ua/NBUStatService/v1/statdirectory/?json): уточняются все группы наборов данных, а также их доступность по интервалам (periods), разрезам (dimensions) и дате ввода (entrydate).

    1.2. Statdirectory/{apikod}: уточняются все доступные наборы данных внутри группы; для получения точного списка с {id_api} необходимо уточнять запрос с датами start= и end=, а также leveli= и parent= для правильного вывода иерархического дерева.

    1.3. [Dimension](https://bank.gov.ua/NBUStatService/v1/statdirectory/dimension?json): уточняется название разреза по ранее полученному коду из Statdirectory.

    1.4. Dimension/{dimension}: уточняется перечень доступных опций внутри определенного разреза.

    1.5. [Dimension/tzep](https://bank.gov.ua/NBUStatService/v1/statdirectory/dimension/tzep?json): уточняется перечень доступных единиц измерения.

2. Сконструированная форма дает возможность отправить запрос на Statdirectory/{apikod} с использованием параметров freq=, start=, end=, {dimension}=, id_api= для отображения графика.

___________________

Рекомендации по API НБУ:

1. ~~В ресурсе Statdirectory периоды отображают доступные интервалы между показателями "на дату". Для отображения "за период" (за месяц, квартал, год) необходимо делать дополнительные вычисления.~~ Сток (Stock - на дату) или поток (Flow - за период) можно брать из Dimension/tzep, однако тогда желательно трансформировать даты в кварталы (например, 01.01.2017 в  2017Q1).

2. ~~В ресурсе Dimensions необходимо проверить названия разрезов. Например, название разреза "Складові MACRO-покзників" отображается с опечаткой (пропущена буква).~~

3. ~~В ресурсе Dimension/{dimension} необходимо проверить доступность и содержание разрезов. Например, разрез "Сектора економіки" odk070 недоступен. Разрез "Територія" частично дублирует "Регіони".~~

4. ~~В ресурсе Statdirectory/{apikod} мы получаем массив объектов, в свойствах которых отсутствует единица измерения, соответственно не понятно это в штуках, процентах, в тысячах, млн, млрд? Это гривны или долл США? Желательно вывести эту информацию в свойствах и/или подкорректировать tzep, т.к. он у всех объектов одинаковый~~. Можно брать из tzep, однако желательно выводить отдельно единицу измерения (грн или долл, количество, проценты) и отдельно размерность. Таким образом разработчики смогут еще больше округлить цифры для графиков (и не округляя для таблиц), а затем добавить свое значение к единице измерения, если нужно.

5. В ресурсе Statdirectory/{apikod}, уточняя его по id_api, start и end, получаем даты в человекочитаемом формате, а не машинном, а также в произвольном порядке. Из-за этого нужно дополнительно работать с датой, чтобы конвертировать ее из доступного DD.MM.YYYY и затем использовать функцию сортировки. Желательно даты выводить в UNIX timestamp.

6. В ресурсах Statdirectory/{apikod} и Dimension/tzep не всегда совпадают значения по регистру. Например, в grossextdebt используется T071usd_7; при этом в справочнике есть T071USD_7. Не критично, решается функцией strtoupper().

7. В ресурсах Statdirectory/securities и Statdirectory/loan вместо leveli используется level. Желательно использовать один и тот же ключ в свойствах объекта.

8. В ресурсе Statdirectory/securities минимальный leveli начинается с 10 ("parent": null). А в ресурсе Statdirectory/shotextdebt с 2. Желательно, чтобы leveli  начинался с 1, как в других группах.

Дополнительно см. [test20171129.pdf](test20171129.pdf)

___________________

Скриншоты приложения: :+1:

![Alt text](/opendata-explorer/ss/01.png?raw=true "Грошові агрегати - M1 - Усі сектори - Графік")

![Alt text](/opendata-explorer/ss/01a.png?raw=true "Грошові агрегати - M1 - Усі сектори - Табличний вигляд")

![Alt text](/opendata-explorer/ss/02.png?raw=true "Валовий зовнішній борг - Сектор загальнодержавного управління - Усього")

![Alt text](/opendata-explorer/ss/03.png?raw=true "Основні показники діяльності банків - Строкові кошти фізичних осіб (з ощадними (депозитними) сертифікатами) - Графік")

![Alt text](/opendata-explorer/ss/04.png?raw=true "Основні показники діяльності банків - Строкові кошти фізичних осіб (з ощадними (депозитними) сертифікатами) - Табличний вигляд")

![Alt text](/opendata-explorer/ss/04a.png?raw=true "Основні показники діяльності банків - Кількість діючих банків - Графік")

![Alt text](/opendata-explorer/ss/05.png?raw=true "Доходи та витрати банків - Повернення списаних активів")

![Alt text](/opendata-explorer/ss/06.png?raw=true "Лiквiднiсть - Рефінансування банків (залишок за основною сумою), на початок дня")

___________________


[DEMO](http://test.roomian.org/opendata-explorer/ "DEMO")

